<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--
        Template amélioré pour l'en-tête des rapports AB Energie

        Structure de l'en-tête (centré) :
        1. Activité (10pt, gras, majuscules)
        2. Adresse (11pt, gras)
        3. Email et Téléphone (10pt, gras)

        Pied de page :
        - Coordonnées fiscales RC/AI/NIF/NIS (relative à team_id)
    -->

    <!-- Désactiver le template du module parent adi_team_header -->
    <record id="adi_team_header.external_layout_custom_header" model="ir.ui.view">
        <field name="active" eval="False"/>
    </record>

    <!-- ================================================================
         EN-TÊTE AMÉLIORÉ - Centré avec adresse/email en gras
         ================================================================ -->
    <template id="external_layout_enhanced_header" inherit_id="web.external_layout_standard" priority="99">
        <xpath expr="//div[@name='company_address']" position="replace">

            <!-- ============================================
                 DEVIS / COMMANDES CLIENTS (sale.order)
                 ============================================ -->
            <t t-if="docs and len(docs) > 0 and docs[0]._name == 'sale.order'">
                <t t-foreach="docs" t-as="doc">
                    <t t-if="doc.team_id">
                        <div class="company-header-enhanced" style="text-align: center; line-height: 1.5; width: 100%;">
                            <!-- 1. Activité - réduit -->
                            <div t-if="doc.team_id.team_description" style="font-weight: bold; font-size: 10pt; color: #000; margin-bottom: 3px; text-transform: uppercase;">
                                <t t-esc="doc.team_id.team_description"/>
                            </div>
                            <!-- 2. Adresse - agrandi et gras -->
                            <div t-if="doc.team_id.team_address" style="font-weight: bold; font-size: 12pt; color: #333; margin-bottom: 3px;">
                                <t t-esc="doc.team_id.team_address"/>
                            </div>
                            <!-- 3. Email et Téléphone - agrandi et gras -->
                            <div style="font-weight: bold; font-size: 11pt; color: #444;">
                                <t t-if="doc.team_id.email">
                                    <span style="margin-right: 15px;">
                                        Email: <span t-field="doc.team_id.email"/>
                                    </span>
                                </t>
                                <t t-if="doc.team_id.tel">
                                    <span>
                                        Tel: <span t-field="doc.team_id.tel"/>
                                    </span>
                                </t>
                            </div>
                        </div>
                    </t>
                </t>
            </t>

            <!-- ============================================
                 BONS DE LIVRAISON (stock.picking)
                 ============================================ -->
            <t t-if="docs and len(docs) > 0 and docs[0]._name == 'stock.picking'">
                <t t-foreach="docs" t-as="o">
                    <!-- Avec équipe de vente -->
                    <t t-if="o.sale_id and o.sale_id.team_id">
                        <div class="company-header-enhanced" style="text-align: center; line-height: 1.5; width: 100%;">
                            <div t-if="o.sale_id.team_id.team_description" style="font-weight: bold; font-size: 10pt; color: #000; margin-bottom: 3px; text-transform: uppercase;">
                                <t t-esc="o.sale_id.team_id.team_description"/>
                            </div>
                            <div t-if="o.sale_id.team_id.team_address" style="font-weight: bold; font-size: 12pt; color: #333; margin-bottom: 3px;">
                                <t t-esc="o.sale_id.team_id.team_address"/>
                            </div>
                            <div style="font-weight: bold; font-size: 11pt; color: #444;">
                                <t t-if="o.sale_id.team_id.email">
                                    <span style="margin-right: 15px;">
                                        Email: <span t-field="o.sale_id.team_id.email"/>
                                    </span>
                                </t>
                                <t t-if="o.sale_id.team_id.tel">
                                    <span>
                                        Tel: <span t-field="o.sale_id.team_id.tel"/>
                                    </span>
                                </t>
                            </div>
                        </div>
                    </t>
                    <!-- Sans équipe - utiliser les infos société -->
                    <t t-else="">
                        <div class="company-header-enhanced" style="text-align: center; line-height: 1.5; width: 100%;">
                            <div t-if="o.company_id.activity_description" style="font-weight: bold; font-size: 10pt; color: #000; margin-bottom: 3px; text-transform: uppercase;">
                                <t t-esc="o.company_id.activity_description"/>
                            </div>
                            <div t-if="o.company_id.street" style="font-weight: bold; font-size: 12pt; color: #333; margin-bottom: 3px;">
                                <t t-esc="o.company_id.street"/>
                                <t t-if="o.company_id.street2">, <t t-esc="o.company_id.street2"/></t>
                                <t t-if="o.company_id.city">, <t t-esc="o.company_id.city"/></t>
                            </div>
                            <div style="font-weight: bold; font-size: 11pt; color: #444;">
                                <t t-if="o.company_id.email">
                                    <span style="margin-right: 15px;">
                                        Email: <span t-field="o.company_id.email"/>
                                    </span>
                                </t>
                                <t t-if="o.company_id.phone">
                                    <span>
                                        Tel: <span t-field="o.company_id.phone"/>
                                    </span>
                                </t>
                            </div>
                        </div>
                    </t>
                </t>
            </t>

            <!-- ============================================
                 FACTURES (account.move)
                 ============================================ -->
            <t t-if="docs and len(docs) > 0 and docs[0]._name == 'account.move'">
                <t t-foreach="docs" t-as="o">
                    <t t-if="o.team_id">
                        <div class="company-header-enhanced" style="text-align: center; line-height: 1.5; width: 100%;">
                            <div t-if="o.team_id.team_description" style="font-weight: bold; font-size: 10pt; color: #000; margin-bottom: 3px; text-transform: uppercase;">
                                <t t-esc="o.team_id.team_description"/>
                            </div>
                            <div t-if="o.team_id.team_address" style="font-weight: bold; font-size: 12pt; color: #333; margin-bottom: 3px;">
                                <t t-esc="o.team_id.team_address"/>
                            </div>
                            <div style="font-weight: bold; font-size: 11pt; color: #444;">
                                <t t-if="o.team_id.email">
                                    <span style="margin-right: 15px;">
                                        Email: <span t-field="o.team_id.email"/>
                                    </span>
                                </t>
                                <t t-if="o.team_id.tel">
                                    <span>
                                        Tel: <span t-field="o.team_id.tel"/>
                                    </span>
                                </t>
                            </div>
                        </div>
                    </t>
                </t>
            </t>

            <!-- ============================================
                 CAS PAR DÉFAUT (autres documents)
                 ============================================ -->
            <t t-if="docs and len(docs) > 0 and docs[0]._name not in ['sale.order', 'stock.picking', 'account.move']">
                <t t-foreach="docs" t-as="doc">
                    <div class="company-header-enhanced" style="text-align: center; line-height: 1.5; width: 100%;">
                        <div t-if="doc.company_id.activity_description" style="font-weight: bold; font-size: 10pt; color: #000; margin-bottom: 3px; text-transform: uppercase;">
                            <t t-esc="doc.company_id.activity_description"/>
                        </div>
                        <div t-if="doc.company_id.street" style="font-weight: bold; font-size: 12pt; color: #333; margin-bottom: 3px;">
                            <t t-esc="doc.company_id.street"/>
                            <t t-if="doc.company_id.street2">, <t t-esc="doc.company_id.street2"/></t>
                            <t t-if="doc.company_id.city">, <t t-esc="doc.company_id.city"/></t>
                        </div>
                        <div style="font-weight: bold; font-size: 11pt; color: #444;">
                            <t t-if="doc.company_id.email">
                                <span style="margin-right: 15px;">
                                    Email: <span t-field="doc.company_id.email"/>
                                </span>
                            </t>
                            <t t-if="doc.company_id.phone">
                                <span>
                                    Tel: <span t-field="doc.company_id.phone"/>
                                </span>
                            </t>
                        </div>
                    </div>
                </t>
            </t>

        </xpath>
    </template>

    <!-- ================================================================
         PIED DE PAGE - Coordonnées fiscales relatives à team_id
         ================================================================ -->
    <template id="external_layout_enhanced_footer" inherit_id="web.external_layout_standard" priority="99">
        <xpath expr="//div[contains(@t-attf-class, 'footer')]/div[@class='text-center']/ul" position="after">

            <!-- Coordonnées fiscales selon le type de document -->
            <div class="fiscal-footer" style="text-align: center; font-size: 9pt; color: #555; margin-top: 8px; padding-top: 5px;">

                <!-- DEVIS / COMMANDES -->
                <t t-if="docs and len(docs) > 0 and docs[0]._name == 'sale.order'">
                    <t t-foreach="docs" t-as="doc">
                        <t t-if="doc.team_id">
                            <t t-if="doc.team_id.rc"><span t-field="doc.team_id.rc"/></t>
                            <t t-if="doc.team_id.ai"> - <span t-field="doc.team_id.ai"/></t>
                            <t t-if="doc.team_id.nif"> - <span t-field="doc.team_id.nif"/></t>
                            <t t-if="doc.team_id.nis"> - <span t-field="doc.team_id.nis"/></t>
                        </t>
                    </t>
                </t>

                <!-- BONS DE LIVRAISON -->
                <t t-if="docs and len(docs) > 0 and docs[0]._name == 'stock.picking'">
                    <t t-foreach="docs" t-as="o">
                        <t t-if="o.sale_id and o.sale_id.team_id">
                            <t t-if="o.sale_id.team_id.rc"><span t-field="o.sale_id.team_id.rc"/></t>
                            <t t-if="o.sale_id.team_id.ai"> - <span t-field="o.sale_id.team_id.ai"/></t>
                            <t t-if="o.sale_id.team_id.nif"> - <span t-field="o.sale_id.team_id.nif"/></t>
                            <t t-if="o.sale_id.team_id.nis"> - <span t-field="o.sale_id.team_id.nis"/></t>
                        </t>
                        <t t-else="">
                            <t t-if="o.company_id.rc">R.C: <span t-field="o.company_id.rc"/></t>
                            <t t-if="o.company_id.ai"> - A.I: <span t-field="o.company_id.ai"/></t>
                            <t t-if="o.company_id.nif"> - N.I.F: <span t-field="o.company_id.nif"/></t>
                            <t t-if="o.company_id.nis"> - N.I.S: <span t-field="o.company_id.nis"/></t>
                        </t>
                    </t>
                </t>

                <!-- FACTURES -->
                <t t-if="docs and len(docs) > 0 and docs[0]._name == 'account.move'">
                    <t t-foreach="docs" t-as="o">
                        <t t-if="o.team_id">
                            <t t-if="o.team_id.rc"><span t-field="o.team_id.rc"/></t>
                            <t t-if="o.team_id.ai"> - <span t-field="o.team_id.ai"/></t>
                            <t t-if="o.team_id.nif"> - <span t-field="o.team_id.nif"/></t>
                            <t t-if="o.team_id.nis"> - <span t-field="o.team_id.nis"/></t>
                        </t>
                    </t>
                </t>

                <!-- AUTRES DOCUMENTS -->
                <t t-if="docs and len(docs) > 0 and docs[0]._name not in ['sale.order', 'stock.picking', 'account.move']">
                    <t t-foreach="docs" t-as="doc">
                        <t t-if="doc.company_id.rc">R.C: <span t-field="doc.company_id.rc"/></t>
                        <t t-if="doc.company_id.ai"> - A.I: <span t-field="doc.company_id.ai"/></t>
                        <t t-if="doc.company_id.nif"> - N.I.F: <span t-field="doc.company_id.nif"/></t>
                        <t t-if="doc.company_id.nis"> - N.I.S: <span t-field="doc.company_id.nis"/></t>
                    </t>
                </t>

            </div>

        </xpath>
    </template>

</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--
        Hériter directement du template adi_team_header
        et remplacer TOUT son contenu par notre logique conditionnelle
    -->
    <template id="external_layout_custom_styled"
              inherit_id="adi_team_header.external_layout_custom_header"
              priority="99">

        <!-- Remplacer le bloc sale.order -->
        <xpath expr='//t[@t-if="docs and docs[0]._name == &apos;sale.order&apos;"]' position="replace">
            <t t-set="use_custom" t-value="company.use_custom_report_template if company else False"/>

            <!-- SALE ORDER -->
            <t t-if="docs and docs[0]._name == 'sale.order'">
                <t t-if="use_custom">
                    <t t-call="adi_report_template_config.header_custom_content"/>
                </t>
                <t t-else="">
                    <!-- Comportement original adi_team_header -->
                    <t t-foreach="docs" t-as="doc">
                        <div t-if="doc.team_id" name="company_address" style="display: inline-block;">
                            <p>
                                <span t-if="doc.team_id.team_address" t-field="doc.team_id.team_address"/><br/>
                                <span t-if="doc.team_id.team_description" t-field="doc.team_id.team_description"/><br/>
                                <t t-if="doc.team_id.rc"><span t-field="doc.team_id.rc"/> - </t>
                                <t t-if="doc.team_id.ai"><span t-field="doc.team_id.ai"/> - </t>
                                <t t-if="doc.team_id.nif"><span t-field="doc.team_id.nif"/> - </t>
                                <t t-if="doc.team_id.nis"><span t-field="doc.team_id.nis"/></t><br/>
                                <span t-if="doc.team_id.email" t-field="doc.team_id.email"/><br/>
                                <span t-if="doc.team_id.tel" t-field="doc.team_id.tel"/>
                            </p>
                        </div>
                    </t>
                </t>
            </t>
        </xpath>

        <!-- Remplacer le bloc stock.picking -->
        <xpath expr='//t[@t-if="docs and docs[0]._name == &apos;stock.picking&apos;"]' position="replace">
            <!-- STOCK PICKING -->
            <t t-if="docs and docs[0]._name == 'stock.picking'">
                <t t-set="use_custom" t-value="company.use_custom_report_template if company else False"/>
                <t t-if="use_custom">
                    <t t-call="adi_report_template_config.header_custom_content"/>
                </t>
                <t t-else="">
                    <!-- Comportement original adi_team_header -->
                    <t t-foreach="docs" t-as="o">
                        <div t-if="o.sale_id and o.sale_id.team_id" name="company_address" style="display: inline-block;">
                            <p>
                                <span t-if="o.sale_id.team_id.team_address" t-field="o.sale_id.team_id.team_address"/><br/>
                                <span t-if="o.sale_id.team_id.team_description" t-field="o.sale_id.team_id.team_description"/><br/>
                                <t t-if="o.sale_id.team_id.rc"><span t-field="o.sale_id.team_id.rc"/> - </t>
                                <t t-if="o.sale_id.team_id.ai"><span t-field="o.sale_id.team_id.ai"/> - </t>
                                <t t-if="o.sale_id.team_id.nif"><span t-field="o.sale_id.team_id.nif"/> - </t>
                                <t t-if="o.sale_id.team_id.nis"><span t-field="o.sale_id.team_id.nis"/></t><br/>
                                <span t-if="o.sale_id.team_id.email" t-field="o.sale_id.team_id.email"/><br/>
                                <span t-if="o.sale_id.team_id.tel" t-field="o.sale_id.team_id.tel"/>
                            </p>
                        </div>
                        <div t-else="" name="company_address" style="display: inline-block;">
                            <p>
                                <span t-if="o.company_id.activity_description" t-field="o.company_id.activity_description"/><br/>
                                <span t-if="o.company_id.street" t-field="o.company_id.street"/><br/>
                                <t t-if="o.company_id.rc"><span>RC: </span><span t-field="o.company_id.rc"/> - </t>
                                <t t-if="o.company_id.ai"><span>AI: </span><span t-field="o.company_id.ai"/> - </t>
                                <t t-if="o.company_id.nif"><span>NIF: </span><span t-field="o.company_id.nif"/> - </t>
                                <t t-if="o.company_id.nis"><span>NIS: </span><span t-field="o.company_id.nis"/></t><br/>
                                <span t-if="o.company_id.email" t-field="o.company_id.email"/><br/>
                                <span t-if="o.company_id.phone" t-field="o.company_id.phone"/>
                            </p>
                        </div>
                    </t>
                </t>
            </t>
        </xpath>

        <!-- Remplacer le bloc account.move -->
        <xpath expr='//t[@t-if="docs and docs[0]._name == &apos;account.move&apos;"]' position="replace">
            <!-- ACCOUNT MOVE -->
            <t t-if="docs and docs[0]._name == 'account.move'">
                <t t-set="use_custom" t-value="company.use_custom_report_template if company else False"/>
                <t t-if="use_custom">
                    <t t-call="adi_report_template_config.header_custom_content"/>
                </t>
                <t t-else="">
                    <!-- Comportement original adi_team_header -->
                    <t t-foreach="docs" t-as="o">
                        <div t-if="o.team_id" name="company_address" style="display: inline-block;">
                            <p>
                                <span t-if="o.team_id.team_address" t-field="o.team_id.team_address"/><br/>
                                <span t-if="o.team_id.team_description" t-field="o.team_id.team_description"/><br/>
                                <t t-if="o.team_id.rc"><span t-field="o.team_id.rc"/> - </t>
                                <t t-if="o.team_id.ai"><span t-field="o.team_id.ai"/> - </t>
                                <t t-if="o.team_id.nif"><span t-field="o.team_id.nif"/> - </t>
                                <t t-if="o.team_id.nis"><span t-field="o.team_id.nis"/></t><br/>
                                <span t-if="o.team_id.email" t-field="o.team_id.email"/><br/>
                                <span t-if="o.team_id.tel" t-field="o.team_id.tel"/>
                            </p>
                        </div>
                    </t>
                </t>
            </t>
        </xpath>

        <!-- Remplacer le bloc par défaut (autres documents) -->
        <xpath expr="//t[@t-if=&quot;docs and docs[0]._name not in ['sale.order', 'stock.picking', 'account.move']&quot;]" position="replace">
            <!-- AUTRES DOCUMENTS -->
            <t t-if="docs and docs[0]._name not in ['sale.order', 'stock.picking', 'account.move']">
                <t t-set="use_custom" t-value="company.use_custom_report_template if company else False"/>
                <t t-if="use_custom">
                    <t t-call="adi_report_template_config.header_custom_content"/>
                </t>
                <t t-else="">
                    <!-- Comportement original adi_team_header -->
                    <t t-foreach="docs" t-as="doc">
                        <div name="company_address" style="display: inline-block;">
                            <p>
                                <span t-if="doc.company_id.activity_description" t-field="doc.company_id.activity_description"/><br/>
                                <span t-if="doc.company_id.street" t-field="doc.company_id.street"/><br/>
                                <t t-if="doc.company_id.rc"><span>RC: </span><span t-field="doc.company_id.rc"/> - </t>
                                <t t-if="doc.company_id.ai"><span>AI: </span><span t-field="doc.company_id.ai"/> - </t>
                                <t t-if="doc.company_id.nif"><span>NIF: </span><span t-field="doc.company_id.nif"/> - </t>
                                <t t-if="doc.company_id.nis"><span>NIS: </span><span t-field="doc.company_id.nis"/></t><br/>
                                <span t-if="doc.company_id.email" t-field="doc.company_id.email"/><br/>
                                <span t-if="doc.company_id.phone" t-field="doc.company_id.phone"/>
                            </p>
                        </div>
                    </t>
                </t>
            </t>
        </xpath>

    </template>

    <!-- ============================================ -->
    <!-- Template de contenu personnalisé            -->
    <!-- Appelé quand use_custom_report_template=True -->
    <!-- ============================================ -->
    <template id="header_custom_content">
        <!-- Récupérer l'équipe depuis le document -->
        <t t-set="team" t-value="False"/>
        <t t-set="doc" t-value="docs[0] if docs else False"/>
        <t t-if="doc">
            <t t-if="doc._name == 'sale.order' and doc.team_id">
                <t t-set="team" t-value="doc.team_id"/>
            </t>
            <t t-elif="doc._name == 'account.move' and doc.team_id">
                <t t-set="team" t-value="doc.team_id"/>
            </t>
            <t t-elif="doc._name == 'stock.picking' and doc.sale_id and doc.sale_id.team_id">
                <t t-set="team" t-value="doc.sale_id.team_id"/>
            </t>
        </t>

        <t t-set="template_style" t-value="company.report_template_style or 'light'"/>
        <t t-set="fiscal_in_footer" t-value="company.fiscal_info_in_footer"/>

        <!-- Appeler le style approprié -->
        <t t-if="template_style == 'box'">
            <t t-call="adi_report_template_config.header_style_box"/>
        </t>
        <t t-elif="template_style == 'bold'">
            <t t-call="adi_report_template_config.header_style_bold"/>
        </t>
        <t t-else="">
            <t t-call="adi_report_template_config.header_style_light"/>
        </t>
    </template>

    <!-- ============================================ -->
    <!-- STYLE LIGHT                                 -->
    <!-- ============================================ -->
    <template id="header_style_light">
        <div name="company_address" style="display: inline-block;">
            <p style="font-size: 9pt; line-height: 1.4; color: #333;">
                <t t-if="team and team.team_address">
                    <span t-field="team.team_address"/><br/>
                </t>
                <t t-elif="company.street">
                    <span t-field="company.street"/><br/>
                </t>

                <t t-if="team and team.team_description">
                    <span t-field="team.team_description" style="font-style: italic;"/><br/>
                </t>
                <t t-elif="company.activity_description">
                    <span t-field="company.activity_description" style="font-style: italic;"/><br/>
                </t>

                <t t-if="not fiscal_in_footer">
                    <span style="font-size: 8pt; color: #6c757d;">
                        <t t-if="team">
                            <t t-if="team.rc"><t t-esc="team.rc"/> - </t>
                            <t t-if="team.ai"><t t-esc="team.ai"/> - </t>
                            <t t-if="team.nif"><t t-esc="team.nif"/> - </t>
                            <t t-if="team.nis"><t t-esc="team.nis"/></t>
                        </t>
                        <t t-else="">
                            <t t-if="company.rc"><t t-esc="company.rc"/> - </t>
                            <t t-if="company.ai"><t t-esc="company.ai"/> - </t>
                            <t t-if="company.nif"><t t-esc="company.nif"/> - </t>
                            <t t-if="company.nis"><t t-esc="company.nis"/></t>
                        </t>
                    </span><br/>
                </t>

                <t t-if="team and team.email">
                    <span t-field="team.email"/><br/>
                </t>
                <t t-elif="company.email">
                    <span t-field="company.email"/><br/>
                </t>

                <t t-if="team and team.tel">
                    <span t-field="team.tel"/>
                </t>
                <t t-elif="company.phone">
                    <span t-field="company.phone"/>
                </t>
            </p>
        </div>
    </template>

    <!-- ============================================ -->
    <!-- STYLE BOX                                   -->
    <!-- ============================================ -->
    <template id="header_style_box">
        <div name="company_address" style="display: inline-block;">
            <div style="border: 1px solid #dee2e6; border-radius: 4px; padding: 8px; background-color: #f8f9fa;">
                <p style="font-size: 9pt; margin: 0;">
                    <t t-if="team and team.team_address">
                        <span t-field="team.team_address"/><br/>
                    </t>
                    <t t-elif="company.street">
                        <span t-field="company.street"/><br/>
                    </t>

                    <t t-if="team and team.team_description">
                        <span t-field="team.team_description" style="font-style: italic; color: #6c757d;"/><br/>
                    </t>
                    <t t-elif="company.activity_description">
                        <span t-field="company.activity_description" style="font-style: italic; color: #6c757d;"/><br/>
                    </t>

                    <t t-if="not fiscal_in_footer">
                        <span style="font-size: 8pt; color: #6c757d; border-top: 1px dashed #dee2e6; display: block; padding-top: 4px; margin-top: 4px;">
                            <t t-if="team">
                                <t t-if="team.rc"><t t-esc="team.rc"/> - </t>
                                <t t-if="team.ai"><t t-esc="team.ai"/> - </t>
                                <t t-if="team.nif"><t t-esc="team.nif"/> - </t>
                                <t t-if="team.nis"><t t-esc="team.nis"/></t>
                            </t>
                            <t t-else="">
                                <t t-if="company.rc"><t t-esc="company.rc"/> - </t>
                                <t t-if="company.ai"><t t-esc="company.ai"/> - </t>
                                <t t-if="company.nif"><t t-esc="company.nif"/> - </t>
                                <t t-if="company.nis"><t t-esc="company.nis"/></t>
                            </t>
                        </span>
                    </t>

                    <t t-if="team and team.email">
                        <span t-field="team.email"/><br/>
                    </t>
                    <t t-elif="company.email">
                        <span t-field="company.email"/><br/>
                    </t>

                    <t t-if="team and team.tel">
                        <span t-field="team.tel"/>
                    </t>
                    <t t-elif="company.phone">
                        <span t-field="company.phone"/>
                    </t>
                </p>
            </div>
        </div>
    </template>

    <!-- ============================================ -->
    <!-- STYLE BOLD                                  -->
    <!-- ============================================ -->
    <template id="header_style_bold">
        <div name="company_address" style="display: inline-block;">
            <div style="font-size: 9pt;">
                <p style="margin: 0 0 4px 0; font-weight: bold;">
                    <t t-if="team and team.team_address">
                        <span t-field="team.team_address"/>
                    </t>
                    <t t-elif="company.street">
                        <span t-field="company.street"/>
                    </t>
                </p>

                <p t-if="(team and team.team_description) or company.activity_description"
                   style="margin: 0 0 4px 0; font-style: italic; color: #495057;">
                    <t t-if="team and team.team_description">
                        <span t-field="team.team_description"/>
                    </t>
                    <t t-else="">
                        <span t-field="company.activity_description"/>
                    </t>
                </p>

                <p t-if="not fiscal_in_footer" style="margin: 0 0 4px 0; font-size: 8pt; color: #6c757d;">
                    <t t-if="team">
                        <t t-if="team.rc"><t t-esc="team.rc"/> - </t>
                        <t t-if="team.ai"><t t-esc="team.ai"/> - </t>
                        <t t-if="team.nif"><t t-esc="team.nif"/> - </t>
                        <t t-if="team.nis"><t t-esc="team.nis"/></t>
                    </t>
                    <t t-else="">
                        <t t-if="company.rc"><t t-esc="company.rc"/> - </t>
                        <t t-if="company.ai"><t t-esc="company.ai"/> - </t>
                        <t t-if="company.nif"><t t-esc="company.nif"/> - </t>
                        <t t-if="company.nis"><t t-esc="company.nis"/></t>
                    </t>
                </p>

                <p style="margin: 0;">
                    <t t-if="team and team.email">
                        <strong>Email:</strong> <span t-field="team.email"/><br/>
                    </t>
                    <t t-elif="company.email">
                        <strong>Email:</strong> <span t-field="company.email"/><br/>
                    </t>

                    <t t-if="team and team.tel">
                        <strong>Tel:</strong> <span t-field="team.tel"/>
                    </t>
                    <t t-elif="company.phone">
                        <strong>Tel:</strong> <span t-field="company.phone"/>
                    </t>
                </p>
            </div>
        </div>
    </template>

</odoo>

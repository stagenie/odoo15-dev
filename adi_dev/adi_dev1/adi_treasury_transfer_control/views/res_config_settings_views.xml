<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ===================================================================
         EXTENSION DES PARAMÈTRES DE CONFIGURATION
         =================================================================== -->

    <record id="res_config_settings_view_form_transfer_control" model="ir.ui.view">
        <field name="name">res.config.settings.form.transfer.control</field>
        <field name="model">res.config.settings</field>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('settings')]" position="inside">
                <div class="app_settings_block" data-string="Contrôle des Transferts"
                     data-key="adi_treasury_transfer_control"
                     groups="adi_treasury.group_treasury_manager">

                    <h2>Contrôle des Transferts de Trésorerie</h2>

                    <div class="row mt16 o_settings_container">

                        <!-- Activation générale -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="transfer_control_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="transfer_control_enabled"/>
                                <div class="text-muted">
                                    Activer les vérifications de solde avant les transferts
                                </div>
                            </div>
                        </div>

                        <!-- Contrôle automatique -->
                        <div class="col-12 col-lg-6 o_setting_box"
                             attrs="{'invisible': [('transfer_control_enabled', '=', False)]}">
                            <div class="o_setting_left_pane">
                                <field name="transfer_auto_check"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="transfer_auto_check"/>
                                <div class="text-muted">
                                    Effectuer automatiquement le contrôle lors de la confirmation
                                </div>
                            </div>
                        </div>

                    </div>

                    <h3 class="mt32"
                        attrs="{'invisible': [('transfer_control_enabled', '=', False)]}">
                        Règles de blocage
                    </h3>

                    <div class="row mt16 o_settings_container"
                         attrs="{'invisible': [('transfer_control_enabled', '=', False)]}">

                        <!-- Bloquer si solde insuffisant -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="transfer_block_insufficient"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="transfer_block_insufficient"/>
                                <div class="text-muted">
                                    Bloquer les transferts si le solde source est insuffisant
                                </div>
                            </div>
                        </div>

                        <!-- Bloquer si découvert dépassé -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="transfer_block_overdraft"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="transfer_block_overdraft"/>
                                <div class="text-muted">
                                    Bloquer les transferts bancaires si le découvert serait dépassé
                                </div>
                            </div>
                        </div>

                        <!-- Bloquer si capacité dépassée -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="transfer_block_capacity"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="transfer_block_capacity"/>
                                <div class="text-muted">
                                    Bloquer les transferts si la capacité de la destination serait dépassée
                                </div>
                            </div>
                        </div>

                        <!-- Autoriser les managers à forcer -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="transfer_allow_manager_force"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="transfer_allow_manager_force"/>
                                <div class="text-muted">
                                    Permettre aux managers de forcer les transferts malgré les erreurs
                                </div>
                            </div>
                        </div>

                    </div>

                    <h3 class="mt32"
                        attrs="{'invisible': [('transfer_control_enabled', '=', False)]}">
                        Journalisation
                    </h3>

                    <div class="row mt16 o_settings_container"
                         attrs="{'invisible': [('transfer_control_enabled', '=', False)]}">

                        <!-- Journaliser les contrôles -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="transfer_log_controls"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="transfer_log_controls"/>
                                <div class="text-muted">
                                    Enregistrer un message dans le chatter pour chaque contrôle
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </xpath>
        </field>
    </record>

</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- Catégories de groupes -->
        <record id="module_category_cash_expense" model="ir.module.category">
            <field name="name">Dépenses de Caisse</field>
            <field name="description">Gestion des dépenses de caisse</field>
            <field name="sequence">10</field>
        </record>

        <!-- Groupes -->
        <record id="group_cash_expense_user" model="res.groups">
            <field name="name">Utilisateur</field>
            <field name="category_id" ref="module_category_cash_expense"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
            <field name="comment">L'utilisateur peut créer et soumettre ses propres dépenses</field>
        </record>

        <record id="group_cash_expense_manager" model="res.groups">
            <field name="name">Responsable</field>
            <field name="category_id" ref="module_category_cash_expense"/>
            <field name="implied_ids" eval="[(4, ref('group_cash_expense_user'))]"/>
            <field name="comment">Le responsable peut approuver les dépenses</field>
        </record>

        <record id="group_cash_expense_cashier" model="res.groups">
            <field name="name">Caissier</field>
            <field name="category_id" ref="module_category_cash_expense"/>
            <field name="implied_ids" eval="[(4, ref('group_cash_expense_user'))]"/>
            <field name="comment">Le caissier peut payer et régler les dépenses</field>
        </record>

        <!-- Règles d'enregistrement -->

        <!-- Utilisateur : peut voir et modifier ses propres dépenses en brouillon -->
        <record id="cash_expense_user_rule" model="ir.rule">
            <field name="name">Dépenses utilisateur</field>
            <field name="model_id" ref="model_cash_expense"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_cash_expense_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Responsable : peut voir toutes les dépenses -->
        <record id="cash_expense_manager_rule" model="ir.rule">
            <field name="name">Dépenses responsable</field>
            <field name="model_id" ref="model_cash_expense"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_cash_expense_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Caissier : peut voir toutes les dépenses approuvées/payées -->
        <record id="cash_expense_cashier_rule" model="ir.rule">
            <field name="name">Dépenses caissier</field>
            <field name="model_id" ref="model_cash_expense"/>
            <field name="domain_force">[('state', 'in', ['approved', 'paid', 'settled'])]</field>
            <field name="groups" eval="[(4, ref('group_cash_expense_cashier'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règles pour les lignes de dépenses (suivent les dépenses) -->
        <record id="cash_expense_line_user_rule" model="ir.rule">
            <field name="name">Lignes de dépenses utilisateur</field>
            <field name="model_id" ref="model_cash_expense_line"/>
            <field name="domain_force">[('expense_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_cash_expense_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="cash_expense_line_manager_rule" model="ir.rule">
            <field name="name">Lignes de dépenses responsable</field>
            <field name="model_id" ref="model_cash_expense_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_cash_expense_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Règles pour les comptes personnels -->
        <record id="personal_cash_account_user_rule" model="ir.rule">
            <field name="name">Compte personnel utilisateur</field>
            <field name="model_id" ref="model_personal_cash_account"/>
            <field name="domain_force">[('employee_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_cash_expense_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="personal_cash_account_manager_rule" model="ir.rule">
            <field name="name">Compte personnel responsable</field>
            <field name="model_id" ref="model_personal_cash_account"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_cash_expense_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
    </data>
</odoo>

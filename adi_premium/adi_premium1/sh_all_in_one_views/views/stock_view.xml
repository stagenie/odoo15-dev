<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue formulaire mouvement de stock -->
    <record id="sh_pol_picking_order_line_move_form" model="ir.ui.view">
        <field name="name">Formulaire Ligne d'Opération</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <form string="Ligne d'Opération" create="false" edit="false">
                <sheet>
                    <group>
                        <group>
                            <field name="date" />
                            <field name="origin" />
                            <field name="sh_pol_picking_order_line_picking_type_id" string="Type de transfert" />
                            <field name="sh_pol_picking_order_line_picking_type_code" string="Opération de transfert" />
                            <field name="reference" />
                            <field name="picking_type_id" invisible="1" />
                        </group>
                        <group>
                            <field name="create_date" invisible="1" groups="base.group_no_one" />
                            <field name="product_id" />
                            <field name="location_id" groups="stock.group_stock_multi_locations" string="Emplacement source" />
                            <field name="location_dest_id" groups="stock.group_stock_multi_locations" string="Emplacement destination" />
                            <field name="product_uom_qty" />
                            <field name="quantity_done" />
                            <field name="product_uom" options="{'no_open': True, 'no_create': True}" string="Unité de mesure" groups="uom.group_uom" />
                            <field name="state" />
                            <field name="product_uom_category_id" />
                            <field name="company_id" />
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Vue liste mouvement de stock -->
    <record id="sh_pol_picking_order_line_move_tree" model="ir.ui.view">
        <field name="name">Liste Lignes d'Opération</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <tree create="false" edit="false">
                <field name="date" />
                <field name="origin" />
                <field name="sh_pol_picking_order_line_picking_type_id" string="Type de transfert" />
                <field name="sh_pol_picking_order_line_picking_type_code" string="Opération de transfert" />
                <field name="reference" />
                <field name="picking_type_id" invisible="1" />
                <field name="create_date" invisible="1" groups="base.group_no_one" />
                <field name="product_id" />
                <field name="location_id" groups="stock.group_stock_multi_locations" string="Emplacement source" />
                <field name="location_dest_id" groups="stock.group_stock_multi_locations" string="Emplacement destination" />
                <field name="product_uom_qty" />
                <field name="quantity_done" />
                <field name="product_uom" options="{'no_open': True, 'no_create': True}" string="Unité de mesure" groups="uom.group_uom" />
                <field name="state" />
            </tree>
        </field>
    </record>

    <!-- Filtre mouvement de stock -->
    <record id="sh_pol_picking_order_line_move_search" model="ir.ui.view">
        <field name="name">Recherche Lignes d'Opération</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_move_search" />
        <field name="arch" type="xml">
            <xpath expr="//filter" position="before">
                <filter string="Réceptions" name="incoming" domain="[('picking_id.picking_type_id.code','=','incoming')]" />
                <filter string="Livraisons" name="outgoing" domain="[('picking_id.picking_type_id.code','=','outgoing')]" />
                <filter string="Interne" name="internal" domain="[('picking_id.picking_type_id.code','=','internal')]" />
                <filter string="Fabrication" name="manufacturing" domain="[('picking_id.picking_type_id.code','=','mrp_operation')]" />
            </xpath>

            <xpath expr="//group" position="inside">
                <filter string="Document source" name="sh_pol_sm_origin_group_by" domain="[]" context="{'group_by':'origin'}" />
                <filter string="Type de transfert" name="sh_pol_sm_picking_type_id_group_by" domain="[]" context="{'group_by':'sh_pol_picking_order_line_picking_type_id'}" />
                <filter string="Opération de transfert" name="sh_pol_sm_picking_type_code_group_by" domain="[]" context="{'group_by':'sh_pol_picking_order_line_picking_type_code'}" />
            </xpath>
        </field>
    </record>

    <!-- Kanban Mouvement de Stock -->
    <record model="ir.ui.view" id="stock_move_kanban">
        <field name="name">Kanban Mouvement de Stock</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="product_id" />
                <field name="product_uom_qty" />
                <field name="location_dest_id" />
                <field name="state" />
                <field name="date" />
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_record_top mb8">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <span><t t-esc="record.product_id.name" /></span>
                                    </strong>
                                </div>
                                <strong>
                                    <field
                                        name="state"
                                        widget="label_selection"
                                        options="{'classes': {'draft': 'default', 'cancel': 'default', 'none': 'danger', 'waiting': 'warning', 'confirmed': 'warning', 'partially_available': 'warning', 'done': 'success'}}"
                                    />
                                </strong>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <t t-esc="product_uom_qty" />
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <t t-esc="record.date.value and record.date.value.split(' ')[0] or False" />
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Calendrier Mouvement de Stock -->
    <record model="ir.ui.view" id="sh_stock_move_calendar">
        <field name="name">Calendrier Mouvement de Stock</field>
        <field name="model">stock.move</field>
        <field name="priority" eval="6" />
        <field name="arch" type="xml">
            <calendar string="Vue Calendrier" date_start="date">
                <field name="origin" />
                <field name="create_date" />
            </calendar>
        </field>
    </record>

    <!-- Pivot Mouvement de Stock -->
    <record id="view_stock_move_pivot" model="ir.ui.view">
        <field name="name">Pivot Mouvement de Stock</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <pivot string="Analyse des Mouvements de Stock">
                <field name="state" type="row" />
                <field name="product_id" type="row" />
                <field name="product_uom_qty" type="measure" />
            </pivot>
        </field>
    </record>

    <!-- Graphique Mouvement de Stock -->
    <record model="ir.ui.view" id="view_stock_move_graph">
        <field name="name">Graphique Mouvement de Stock</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <graph string="Mouvement de Stock">
                <field name="product_id" />
                <field name="partner_id" type="measure" />
            </graph>
        </field>
    </record>

    <!-- Action mouvement de stock -->
    <record id="sh_pol_picking_order_line_move_action" model="ir.actions.act_window">
        <field name="name">Lignes d'Opération</field>
        <field name="res_model">stock.move</field>
        <field name="view_mode">tree,form,kanban,pivot,calendar,graph</field>
        <field name="search_view_id" ref="sh_pol_picking_order_line_move_search" />
        <field
            name="view_ids"
            eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('sh_pol_picking_order_line_move_tree')}),
                (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_stock_move_pivot')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('sh_pol_picking_order_line_move_form')})]"
        />
    </record>

    <!-- Action Réception -->
    <record id="sh_pol_incoming_order_line_move_action" model="ir.actions.act_window">
        <field name="name">Lignes de Réception</field>
        <field name="res_model">stock.move</field>
        <field name="view_mode">tree,form,kanban,pivot,calendar,graph</field>
        <field name="domain">[('picking_id.picking_type_id.code','=','incoming')]</field>
        <field name="search_view_id" ref="sh_pol_picking_order_line_move_search" />
        <field
            name="view_ids"
            eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('sh_pol_picking_order_line_move_tree')}),
                (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_stock_move_pivot')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('sh_pol_picking_order_line_move_form')})]"
        />
    </record>

    <!-- Action Livraison -->
    <record id="sh_pol_outgoing_order_line_move_action" model="ir.actions.act_window">
        <field name="name">Lignes de Livraison</field>
        <field name="res_model">stock.move</field>
        <field name="view_mode">tree,form,kanban,pivot,calendar,graph</field>
        <field name="domain">[('picking_id.picking_type_id.code','=','outgoing')]</field>
        <field name="search_view_id" ref="sh_pol_picking_order_line_move_search" />
        <field
            name="view_ids"
            eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('sh_pol_picking_order_line_move_tree')}),
                (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_stock_move_pivot')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('sh_pol_picking_order_line_move_form')})]"
        />
    </record>

    <menuitem id="sh_pol_picking_order_line_ops_menu" name="Lignes d'Opération" parent="stock.menu_stock_warehouse_mgmt" sequence="6" action="sh_pol_picking_order_line_move_action" groups="stock.group_stock_manager,stock.group_stock_user" />

    <menuitem id="sh_pol_incoming_order_line_ops_menu" name="Lignes de Réception" parent="stock.menu_stock_warehouse_mgmt" sequence="7" action="sh_pol_incoming_order_line_move_action" groups="stock.group_stock_manager,stock.group_stock_user" />

    <menuitem id="sh_pol_outgoing_order_line_ops_menu" name="Lignes de Livraison" parent="stock.menu_stock_warehouse_mgmt" sequence="8" action="sh_pol_outgoing_order_line_move_action" groups="stock.group_stock_manager,stock.group_stock_user" />

    <!-- =================== stock.move.line ================== -->

    <!-- Vue formulaire ligne de mouvement -->
    <record id="sh_pol_picking_order_line_move_line_form" model="ir.ui.view">
        <field name="name">Formulaire Ligne d'Opération Détaillée</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <form string="Ligne d'Opération Détaillée" create="false" edit="false">
                <sheet>
                    <group>
                        <group>
                            <field name="date" />
                            <field name="sh_pol_picking_order_line_origin" />
                            <field name="sh_pol_picking_order_line_picking_type_id" string="Type de transfert" />
                            <field name="sh_pol_picking_order_line_picking_type_code" string="Opération de transfert" />
                            <field name="reference" string="Référence" />
                            <field name="product_id" />
                        </group>
                        <group>
                            <field name="location_id" string="Emplacement source" />
                            <field name="location_dest_id" string="Emplacement destination" />
                            <field name="qty_done" string="Quantité effectuée" />
                            <field name="product_uom_category_id" />
                            <field name="product_uom_id" options="{'no_open': True, 'no_create': True}" string="Unité de mesure" groups="uom.group_uom" />
                            <field name="state" />
                            <field name="company_id" />
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Vue liste ligne de mouvement -->
    <record id="sh_pol_picking_order_line_move_line_tree" model="ir.ui.view">
        <field name="name">Liste Lignes d'Opération Détaillée</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <tree create="false" edit="false">
                <field name="date" />
                <field name="sh_pol_picking_order_line_origin" />
                <field name="sh_pol_picking_order_line_picking_type_id" string="Type de transfert" />
                <field name="sh_pol_picking_order_line_picking_type_code" string="Opération de transfert" />
                <field name="reference" string="Référence" />
                <field name="product_id" />
                <field name="location_id" string="Emplacement source" />
                <field name="location_dest_id" string="Emplacement destination" />
                <field name="qty_done" string="Quantité effectuée" />
                <field name="product_uom_category_id" />
                <field name="product_uom_id" options="{'no_open': True, 'no_create': True}" string="Unité de mesure" groups="uom.group_uom" />
                <field name="state" />
            </tree>
        </field>
    </record>

    <!-- Filtre ligne de mouvement -->
    <record id="sh_pol_picking_order_line_move_line_search" model="ir.ui.view">
        <field name="name">Recherche Lignes d'Opération Détaillée</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.stock_move_line_view_search" />
        <field name="arch" type="xml">
            <xpath expr="//group" position="inside">
                <filter string="Document source" name="sh_pol_sml_origin_group_by" domain="[]" context="{'group_by':'sh_pol_picking_order_line_origin'}" />
                <filter string="Type de transfert" name="sh_pol_sml_picking_type_id_group_by" domain="[]" context="{'group_by':'sh_pol_picking_order_line_picking_type_id'}" />
                <filter string="Opération de transfert" name="sh_pol_sml_picking_type_code_group_by" domain="[]" context="{'group_by':'sh_pol_picking_order_line_picking_type_code'}" />
            </xpath>
        </field>
    </record>

    <!-- Calendrier Ligne de Mouvement -->
    <record model="ir.ui.view" id="sh_stock_move_line_calendar">
        <field name="name">Calendrier Ligne de Mouvement</field>
        <field name="model">stock.move.line</field>
        <field name="priority" eval="5" />
        <field name="arch" type="xml">
            <calendar string="Vue Calendrier" date_start="date">
                <field name="sh_pol_picking_order_line_origin" />
                <field name="sh_pol_picking_order_line_picking_type_id" />
            </calendar>
        </field>
    </record>

    <!-- Kanban Ligne de Mouvement -->
    <record model="ir.ui.view" id="stock_move_line_kanban">
        <field name="name">Kanban Ligne de Mouvement</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="product_id" />
                <field name="qty_done" />
                <field name="location_dest_id" />
                <field name="state" />
                <field name="date" />
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_record_top mb8">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <span><t t-esc="record.product_id.name" /></span>
                                    </strong>
                                </div>
                                <strong>
                                    <field
                                        name="state"
                                        widget="label_selection"
                                        options="{'classes': {'draft': 'default', 'cancel': 'default', 'none': 'danger', 'waiting': 'warning', 'confirmed': 'warning', 'partially_available': 'warning', 'done': 'success'}}"
                                    />
                                </strong>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <t t-esc="qty_done" />
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <t t-esc="record.date.value and record.date.value.split(' ')[0] or False" />
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Pivot Ligne de Mouvement -->
    <record id="view_sh_stock_move_line_pivot" model="ir.ui.view">
        <field name="name">Pivot Ligne de Mouvement</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <pivot string="Analyse des Lignes de Mouvement">
                <field name="sh_pol_picking_order_line_picking_type_code" type="row" />
                <field name="state" type="row" />
                <field name="picking_id" type="row" />
                <field name="product_id" type="row" />
                <field name="location_dest_id" groups="stock.group_stock_multi_locations" type="measure" />
                <field name="qty_done" type="measure" />
            </pivot>
        </field>
    </record>

    <!-- Graphique Ligne de Mouvement -->
    <record model="ir.ui.view" id="view_stock_move_line_graph">
        <field name="name">Graphique Ligne de Mouvement</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <graph string="Ligne de Mouvement">
                <field name="product_id" />
                <field name="picking_id" type="measure" />
            </graph>
        </field>
    </record>

    <!-- Action ligne de mouvement -->
    <record id="sh_pol_picking_order_line_move_line_action" model="ir.actions.act_window">
        <field name="name">Lignes d'Opération Détaillée</field>
        <field name="res_model">stock.move.line</field>
        <field name="view_mode">tree,form,kanban,calendar,pivot,graph</field>
        <field name="search_view_id" ref="sh_pol_picking_order_line_move_line_search" />
        <field
            name="view_ids"
            eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('sh_pol_picking_order_line_move_line_tree')}),
                (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_sh_stock_move_line_pivot')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('sh_pol_picking_order_line_move_line_form')})]"
        />
    </record>

    <menuitem id="sh_pol_picking_order_line_details_ops_menu" name="Lignes d'Opération Détaillée" parent="stock.menu_stock_warehouse_mgmt" sequence="11" action="sh_pol_picking_order_line_move_line_action" groups="stock.group_stock_manager,stock.group_stock_user" />
</odoo>
